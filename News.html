<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nachrichten in 100 Sekunden im Wartezimmer</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: "Open Sans", Arial, sans-serif;
    overflow: hidden;
  }

  .container {
    position: relative;
    width: 100vw;
    height: 100vh;
  }

  /* Hintergrundbild */
  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    transition: opacity 1s ease;
  }

  /* Bauchbinde mit Titel und Beschreibung */
  .text-overlay {
    position: absolute;
    bottom: 4%; /* Abstand von unten */
    right: 0;   /* Rechtsbündig */
    width: 90%;  /* 90% der Breite für die Bauchbinde */
    background: rgba(14, 31, 83, 0.7); /* Transparente Bauchbinde mit der Farbe #0e1f53 */
    padding: 20px 30px;
    box-sizing: border-box;
  }

  /* Titel-Text */
  .text-overlay h1 {
    font-size: 1.5em; /* Kleinere Schriftgröße für den Titel */
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: left; /* Titel linksbündig */
  }

  /* Beschreibungstext */
  .text-overlay p {
    font-size: 1em; /* Kleinere Schriftgröße für die Beschreibung */
    margin: 10px 0 0 0; /* Abstand nach dem Titel */
    overflow: visible; /* Keine Beschneidung mehr */
    white-space: normal; /* Damit die Beschreibung unter dem Titel geht */
    text-align: left; /* Beschreibung linksbündig */
  }

  /* Container für Uhr und Ticker */
  #bottomBar {
    position: absolute;
    bottom: 0;
    right: 0;  /* Am rechten Bildschirmrand */
    width: 90%; /* Ganze Breite der blauen Leiste */
    display: flex;
    justify-content: flex-start;
    align-items: center;
    background: #0e1f53; /* Hintergrundfarbe für die Leiste */
    padding: 5px 0; /* Verringere Höhe der Leiste */
  }

  /* Uhr */
  #clock {
    background: #0e1f53; /* Hintergrundfarbe der Uhr */
    padding: 5px 10px;
    font-size: 1.2em; /* Gleiche Schriftgröße wie Ticker */
    font-weight: bold;
    width: 10%; /* 10% Breite für die Uhr */
    text-align: center;
  }

  /* Tickerleiste */
  #ticker {
    background: #0e1f53; /* Hintergrundfarbe des Tickers */
    padding: 5px 10px;
    font-size: 1.2em; /* Gleiche Schriftgröße wie Uhr */
    font-weight: bold;
    width: 80%;  /* 80% Breite für den Ticker */
    text-align: left;
    white-space: nowrap;
    overflow: hidden; /* Versteckt Text, der aus dem Container herausgeht */
  }

  /* Fade-Effekte für Übergänge */
  .fade-out {
    opacity: 0;
  }

  .fade-in {
    opacity: 1;
  }
</style>
</head>
<body>

<div class="container">
  <img id="newsImage" src="" alt="Nachrichtensymbol">
  
  <!-- Bauchbinde mit Titel und Beschreibung -->
  <div class="text-overlay">
    <h1 id="newsTitle">Nachricht wird geladen...</h1>
    <p id="newsDescription"></p>
  </div>

  <!-- Blaue Leiste (direkt unter der Bauchbinde) -->
  <div id="bottomBar">
    <div id="clock">00:00</div>
    <div id="ticker">Börsenwerte werden geladen...</div>
  </div>
</div>

<script>
const feeds = [
  "https://www.tagesschau.de/infoservices/alle-meldungen-100~rss2.xml"
];

let newsItems = [];
let currentIndex = 0;
const placeholderImage = "https://via.placeholder.com/1920x1080?text=Keine+Vorschau";

const newsImage = document.getElementById('newsImage');
const newsTitle = document.getElementById('newsTitle');
const newsDescription = document.getElementById('newsDescription');
const ticker = document.getElementById('ticker');

newsImage.onerror = () => {
  newsImage.src = placeholderImage;
};

function enlargeImageUrl(imageUrl) {
  if (imageUrl) {
    return imageUrl.replace(/w\d+/i, "w1920");
  }
  return imageUrl;
}

async function fetchNews() {
  try {
    const allItems = [];

    for (const feedUrl of feeds) {
      const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent(feedUrl));
      const data = await response.json();
      const text = data.contents;

      const parser = new DOMParser();
      const xml = parser.parseFromString(text, "application/xml");
      const items = xml.querySelectorAll("item");

      items.forEach(item => {
        const title = item.querySelector("title")?.textContent || "Keine Überschrift";
        const rawDesc = item.querySelector("description")?.textContent || "";
        const description = rawDesc.replace(/<[^>]*>/g, '').trim();

        let imageUrl = null;
        const contentEncoded = item.getElementsByTagName("content:encoded")[0]?.textContent;
        if (contentEncoded) {
          const match = contentEncoded.match(/<img[^>]+src="([^">]+)"/);
          if (match && match[1]) {
            imageUrl = match[1];
          }
        }

        if (!imageUrl) {
          const enclosure = item.querySelector("enclosure");
          if (enclosure) {
            imageUrl = enclosure.getAttribute("url");
          }
        }

        if (!imageUrl) {
          imageUrl = placeholderImage;
        }

        imageUrl = enlargeImageUrl(imageUrl);

        const pubDate = item.querySelector("pubDate")?.textContent;
        const date = pubDate ? new Date(pubDate) : new Date();

        allItems.push({ title, description, imageUrl, date });
      });
    }

    // Sortieren nach Datum (neueste zuerst)
    allItems.sort((a, b) => b.date - a.date);

    // Nur die neuesten 10
    newsItems = allItems.slice(0, 10);

    showNews();
    setInterval(nextNews, 10000);
  } catch (e) {
    console.error("Fehler beim Laden der Nachrichten", e);
    newsTitle.textContent = "504 Gateway Timeout";
    newsDescription.textContent = "";
  }
}

function showNews() {
  if (newsItems.length === 0) return;
  const item = newsItems[currentIndex];

  newsImage.classList.add('fade-out');
  newsTitle.classList.add('fade-out');
  newsDescription.classList.add('fade-out');

  setTimeout(() => {
    newsImage.src = item.imageUrl || placeholderImage;
    newsTitle.textContent = item.title;
    newsDescription.textContent = item.description;

    newsImage.classList.remove('fade-out');
    newsImage.classList.add('fade-in');
    newsTitle.classList.remove('fade-out');
    newsTitle.classList.add('fade-in');
    newsDescription.classList.remove('fade-out');
    newsDescription.classList.add('fade-in');
  }, 1000);
}

function nextNews() {
  currentIndex = (currentIndex + 1) % newsItems.length;
  showNews();
}

function updateClock() {
  const clock = document.getElementById("clock");
  const now = new Date();
  const hours = now.getHours().toString().padStart(2, "0");
  const minutes = now.getMinutes().toString().padStart(2, "0");
  clock.textContent = `${hours}:${minutes}`;
}

fetchNews();
updateClock();
setInterval(updateClock, 10000);
</script>

</body>
</html>
